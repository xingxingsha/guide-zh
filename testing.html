<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Testing | Meteor 指南 中译本</title>
    <meta name="description" content="How to test your Meteor application">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://guide-zh.ourmeteor.com">
    <meta property="og:title" content="Testing | Meteor 指南 中译本">
    <meta property="og:description" content="How to test your Meteor application">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@meteor">
    <meta name="twitter:title" content="Testing | Meteor 指南 中译本">
    <meta name="twitter:description" content="How to test your Meteor application">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="sidebar">
  <div class="panel">
    <div class="panel-item logo">
      <a href="http://www.meteor.com/developers" title="Meteor Developers" target=_new >
        <img src="../images/icon-white.svg" alt="Meteor Developers">
        <span>Meteor Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://www.meteor.com/tutorials" target=_new >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><g fill="#112B49"><circle cx="80.001" cy="80" r="3"/><path d="M75.73 85.723c.193-.183.316-.437.316-.723 0-.553-.447-1-1-1-.278 0-.528.114-.71.297l-.004-.004-50.9 50.875c-.18.18-.29.43-.29.707-.002.553.445 1 .998 1 .276 0 .526-.112.708-.293l50.883-50.86zM84.235 74.4c-.18.183-.292.433-.292.71 0 .552.446 1 1 1 .275 0 .525-.113.707-.294l50.87-50.89c.204-.184.34-.442.34-.74 0-.552-.448-1-1-1-.276 0-.526.113-.707.294l-.01-.01L84.236 74.4zM136.583 135.184L85.65 84.23c-.182-.18-.432-.293-.708-.293-.552 0-1 .447-1 1 0 .278.114.528.297.71l50.927 50.95c.18.18.43.293.708.293.553 0 1-.447 1-1 0-.276-.11-.525-.292-.706zM111.19 152.602l-.003-.005-.002-.004-27.552-66.507h-.002c-.15-.362-.505-.617-.922-.617-.552 0-1 .446-1 1 0 .135.028.263.077.38v.002l.005.012 27.552 66.504c.15.362.507.617.924.617.553 0 1-.447 1-1 0-.136-.03-.265-.077-.383zM48.873 7.384L76.435 73.93h.002c.15.362.505.617.922.617.552 0 1-.447 1-1 0-.136-.03-.264-.078-.382h.003L50.72 6.616c-.15-.362-.506-.617-.923-.617-.552 0-1 .447-1 1 0 .136.03.265.078.383h-.002zM152.55 48.844h-.002L86.092 76.422c-.36.15-.617.507-.617.924 0 .553.446 1 1 1 .135 0 .265-.028.383-.077L153.32 50.69c.363-.15.618-.507.618-.924 0-.553-.447-1-1-1-.136 0-.265.028-.383.077h-.005zM7.41 111.136h.002l66.492-27.54c.36-.15.616-.507.616-.924 0-.553-.447-1-1-1-.136 0-.264.028-.382.077v-.002l-.004.002c-.002 0-.004 0-.006.002L6.638 109.29c-.36.15-.615.507-.615.924 0 .553.446 1 1 1 .135 0 .264-.028.382-.077h.004zM159 79H87c-.552 0-1 .448-1 1 0 .554.447 1 1 1h72c.553 0 1-.447 1-1s-.447-1-1-1zM23.435 24.85l50.897 50.897.008-.008c.182.18.43.29.707.29.553 0 1-.446 1-1 0-.296-.135-.555-.34-.737L24.85 23.433c-.183-.18-.433-.292-.71-.292-.55 0-.998.448-.998 1 0 .277.11.528.293.71zM6.618 50.657v.002l66.51 27.54c.003 0 .005 0 .007.002l.004.002c.117.048.245.076.38.076.554 0 1-.447 1-1 0-.417-.254-.772-.616-.923v-.002L7.392 48.813H7.39l-.005-.003c-.118-.047-.247-.076-.383-.076-.552 0-1 .447-1 1 0 .417.256.773.618.923zM153.383 109.28l-66.52-27.53-.006-.002c-.118-.048-.248-.076-.384-.076-.552 0-1 .447-1 1 0 .417.256.773.62.923l66.513 27.528c.003 0 .005 0 .007.002l.004.002c.118.048.246.076.382.076.552 0 1-.447 1-1 0-.417-.256-.772-.617-.923zM80 74c.553 0 1-.447 1-1V1c0-.553-.447-1-1-1-.552 0-1 .447-1 1v72c0 .553.447 1 1 1zM80 86c-.552 0-1 .447-1 1v72c0 .553.447 1 1 1s1-.447 1-1V87c0-.553-.447-1-1-1zM77.36 85.47c-.417 0-.772.254-.923.616l-27.564 66.53.002.002c-.05.117-.077.246-.077.382 0 .553.446 1 1 1 .416 0 .772-.255.922-.618h.002L78.28 86.86v-.004l.003-.005c.048-.117.076-.246.076-.382 0-.552-.448-1-1-1zM82.708 74.547c.417 0 .772-.255.923-.618h.003l27.56-66.547h-.004c.048-.12.076-.247.076-.383 0-.553-.447-1-1-1-.416 0-.772.255-.922.618h-.002l-27.56 66.546h.004c-.05.12-.077.247-.077.383-.002.553.445 1 .998 1zM74 80c0-.552-.446-1-1-1H1c-.552 0-1 .447-1 1 0 .553.447 1 1 1h72c.554 0 1-.446 1-1z"/></g></svg>
          <span>教程</span>
        </a>
      </div>
    
      <div class="panel-item active"">
        <a class="" href="http://guide.meteor.com"  >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#BDA671" d="M80 1.988c43.01 0 78 34.99 78 78s-34.99 78-78 78-78-34.99-78-78 34.99-78 78-78m0-2c-44.183 0-80 35.817-80 80s35.817 80 80 80 80-35.817 80-80-35.817-80-80-80z"/><path fill="#BDA671" d="M126.454 33.545l-37.93 54.98-54.98 37.93 37.93-54.98 54.98-37.93m0-2c-.395 0-.79.116-1.135.354L70.336 69.826c-.2.138-.373.312-.51.51l-37.93 54.98c-.548.796-.45 1.868.232 2.55.386.388.898.587 1.414.587.395 0 .79-.116 1.135-.354l54.98-37.93c.2-.137.373-.31.51-.51l37.93-54.98c.548-.795.45-1.867-.232-2.55-.387-.386-.9-.585-1.414-.585z"/><circle fill="#BDA671" cx="79.999" cy="79.999" r="2.999"/><path fill="#BDA671" d="M135.477 50.182c-.02-.036-.04-.05-.06-.045-.173-.303-.485-.516-.858-.516-.553 0-1 .448-1 1 0 .21.078.394.188.554l-.02.007C138.358 59.766 141 69.57 141 79.99c0 33.636-27.364 61-61 61-10.42 0-20.232-2.634-28.82-7.26l-.005.02c-.144-.08-.3-.14-.478-.14-.552 0-1 .448-1 1 0 .336.176.618.43.8-.016.012-.034.025-.03.027 8.896 4.81 19.078 7.552 29.904 7.552 34.795 0 63-28.206 63-63 0-10.79-2.735-20.93-7.523-29.805zM109.65 24.47c-.002-.02.004-.04-.025-.056-8.83-4.727-18.908-7.426-29.625-7.426-34.794 0-63 28.206-63 63 0 10.79 2.73 20.935 7.514 29.81.005.01.012.004.018.01.17.312.488.532.87.532.552 0 1-.447 1-1 0-.197-.073-.37-.17-.525l.04-.002C21.642 100.223 19 90.41 19 79.988c0-33.636 27.364-61 61-61 10.4 0 20.185 2.634 28.757 7.248.02.01.036.02.055.028.116.047.24.075.37.075.554 0 1-.448 1-1 .002-.382-.22-.7-.533-.87z"/></svg>
          <span>指南</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://docs.meteor.com"  >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#DE4F4F" d="M35.6 30.167v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375H80c.552 0 1 .447 1 1v10.873c1.162.413 2 1.51 2 2.816 0 1.657-1.343 3-3 3s-3-1.343-3-3c0-1.305.837-2.402 2-2.815v-9.873H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1s.448-1 1-1h90.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6zM138 6.564H22c-1.104 0-2 .896-2 2v144c0 1.104.896 2 2 2h48.995c.258 0 .516-.097.712-.293.39-.39.39-1.022 0-1.413-.195-.195-.45-.293-.707-.293H22v-144h116v144H89.006c-.258 0-.517.097-.713.293-.39.39-.39 1.023 0 1.414.196.198.455.294.713.293H138c1.104 0 2-.895 2-2v-144c0-1.103-.896-2-2-2z"/></svg>
          <span>API 文档</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://forums.meteor.com/" target=_new >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#333" d="M60.025 17.72c7.396 0 14.914 1.424 22.172 4.43 29.594 12.258 43.648 46.188 31.39 75.782-9.25 22.334-30.843 35.812-53.6 35.812-4.694 0-9.437-.574-14.132-1.76L32.44 142.277 30.23 125.51C5.908 111.003-4.74 80.48 6.418 53.538 15.67 31.204 37.266 17.72 60.025 17.72m0-2c-24.363 0-46.13 14.545-55.455 37.053-5.547 13.394-6.06 28.33-1.447 42.052 4.465 13.276 13.414 24.57 25.252 31.896l2.082 15.82c.092.708.557 1.31 1.217 1.585.246.104.506.152.766.152.434 0 .86-.142 1.217-.412l12.656-9.713c4.482 1.055 9.076 1.59 13.674 1.59 24.36 0 46.126-14.543 55.447-37.047 6.135-14.807 6.135-31.115.002-45.922C109.3 37.966 97.77 26.433 82.963 20.3c-7.34-3.04-15.06-4.58-22.938-4.58zM92.69 133.9c.165-.443.614-.683 1.064-.623l.004-.024c5.18.558 10.343.396 15.365-.414v2.034c-5.13.796-10.4.942-15.69.356l.002-.02c-.052-.01-.105-.006-.158-.023-.517-.193-.78-.768-.586-1.287z"/><path fill="#333" d="M100.877 133.604c4.41-.065 8.86-.633 13.268-1.746l13.416 10.295 2.208-16.77c24.324-14.505 34.976-45.03 23.814-71.97-9.248-22.33-30.832-35.81-53.584-35.82v.02c-2.072-.002-4.154.096-6.238.32l-.004-.024c-.45.058-.9-.18-1.064-.625-.194-.518.068-1.093.586-1.286.054-.02.107-.015.158-.026l-.002-.02c2.19-.24 4.377-.348 6.553-.35v-.01c24.36.004 46.12 14.545 55.443 37.054 5.55 13.393 6.062 28.327 1.447 42.05-4.465 13.28-13.414 24.57-25.252 31.897l-2.082 15.818c-.092.71-.557 1.312-1.217 1.586-.246.103-.506.15-.766.15-.435 0-.86-.14-1.218-.412l-12.655-9.713c-4.2.988-8.502 1.502-12.812 1.564l.002-1.986z"/><circle fill="#333" cx="60.019" cy="77" r="3.001"/><circle fill="#333" cx="76.018" cy="77" r="3"/><circle fill="#333" cx="44.019" cy="77" r="3.001"/></svg>

          <span>论坛</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Meteor 指南 中译本</span>
      
        <span class="select version-sidebar nochrome">
          <select class="version-select">
            
              <option value="v1.3">1.3</option>
            
              <option value="v1.2">1.2</option>
            
          </select>
        </span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search 官方指南" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>介绍</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="code-style.html" class="sidebar-link ">
                  <span>编码风格</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="structure.html" class="sidebar-link ">
                  <span>Application Structure</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="1.3-migration.html" class="sidebar-link ">
                  <span>Migrating to Meteor 1.3</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">数据</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="collections.html" class="sidebar-link ">
                  <span>数据集与数据结构</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="data-loading.html" class="sidebar-link ">
                  <span>Publications and Data Loading</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="methods.html" class="sidebar-link ">
                  <span>Methods</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="accounts.html" class="sidebar-link ">
                  <span>Users and Accounts</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Testing</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">视图</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>URL 和路由</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="ui-ux.html" class="sidebar-link ">
                  <span>User Interfaces</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="blaze.html" class="sidebar-link ">
                  <span>Blaze</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="react.html" class="sidebar-link ">
                  <span>React</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="angular.html" class="sidebar-link ">
                  <span>Angular</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">构建</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="atmosphere-vs-npm.html" class="sidebar-link ">
                  <span>Atmosphere vs. npm</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="using-atmosphere-packages.html" class="sidebar-link ">
                  <span>Using Atmosphere Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="writing-atmosphere-packages.html" class="sidebar-link ">
                  <span>Writing Atmosphere Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="using-npm-packages.html" class="sidebar-link ">
                  <span>Using npm Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="writing-npm-packages.html" class="sidebar-link ">
                  <span>Writing npm Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mobile.html" class="sidebar-link ">
                  <span>Mobile</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="build-tool.html" class="sidebar-link ">
                  <span>Build System</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">生产环境</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="security.html" class="sidebar-link ">
                  <span>Security</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment and Monitoring</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">有关本指南</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="CONTRIBUTING.html" class="sidebar-link ">
                  <span>Contribution Guidelines</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="CHANGELOG.html" class="sidebar-link ">
                  <span>Changelog</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>


<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item">
      <span class="js-sidebar-toggle">
        <span class="icon-menu"></span>
      </span>
    </div>
  </div>

  <div class="center-wrapper">
    <img src="../images/logo-coralspace.svg" alt="Meteor 指南 中译本"/>
    <div>官方指南</div>
  </div>

  
  <div class="nav-group right">
    <div class="nav-item">
      <span class="js-search-toggle">
        <span class="icon-search"></span>
      </span>
    </div>
  </div>

  <div class="nav-search">
    <div class="input-symbol">
      <input type="text" placeholder="Search 官方指南" id="mobile-search-input"/>
      <span class="icon-search"></span>
    </div>

    <div class="nav-group right">
      <div class="nav-item">
        <span class="js-search-toggle">
          <span class="icon-close"></span>
        </span>
      </div>
    </div>
    
    <div class="wrapper-mobile-search-results"></div>
  </div>
  
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Testing</h1>
      
        <div class="subtitle-page">How to test your Meteor application</div>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn primary small round lowercase" href="https://github.com/ourmeteor/guide-zh/tree/master/content/testing.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
            <a class="btn tertiary small round lowercase" href="https://forums.meteor.com/t/20191"><span class="icon-comment"></span> <span>Discuss</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="introduction">Introduction</h2>

<p>Testing allows you to ensure your application works the way you think it does, especially as your codebase changes over time. If you have good tests, you can refactor and rewrite code with confidence. Tests are also the most concrete form of documentation of expected behavior, since other developers can figure out how to use your code by reading the tests.</p>
<p>Automated testing is critical because it allows you to run a far greater set of tests much more often than you could manually, allowing you to catch regression errors immediately.</p>
<h3 id="testing-types">Types of tests</h3>

<p>Entire books have been written on the subject of testing, so we will simply touch on some basics of testing here. The important thing to consider when writing a test is what part of the application you are trying to test, and how you are verifying the behavior works.</p>
<ul>
<li><p><strong>Unit test</strong>: If you are testing one small module of your application, you are writing a unit test. You’ll need to <em>stub</em> and <em>mock</em> other modules that your module usually leverages in order to <em>isolate</em> each test. You’ll typically also need to <em>spy</em> on actions that the module takes to verify that they occur.</p>
</li>
<li><p><strong>Integration test</strong>: If you are testing that multiple modules behave properly in concert, you are writing an integration test. Such tests are much more complex and may require running code both on the client and on the server to verify that communication across that divide is working as expected. Typically an integration test will still isolate a part of the entire application and directly verify results in code.</p>
</li>
<li><p><strong>Acceptance test</strong>: If you want to write a test that can be run against any running version of your app and verifies at the browser level that the right things happen when you push the right buttons, then you are writing an acceptance test (sometimes called “end to end test”). Such tests typically try to hook into the application as little as possible, beyond perhaps setting up the right data to run a test against.</p>
</li>
<li><p><strong>Load test</strong>: Finally you may wish to test that your application works under typical load or see how much load it can handle before it falls over. This is called a load test or stress test. Such tests can be challenging to set up and typically aren’t run often but are very important for confidence before a big production launch.</p>
</li>
</ul>
<h3 id="challenges-with-meteor">Challenges of testing in Meteor</h3>

<p>In most ways, testing a Meteor app is no different from testing any other full stack JavaScript application. However, compared to more traditional backend or front-end focused frameworks, two factors can make testing a little more challenging:</p>
<ul>
<li><p><strong>Client/server data</strong>: Meteor’s data system makes it simple to bridge the client-server gap and often allows you to build your application without thinking about how data moves around. It becomes critical to test that your code does actually work correctly across that gap. In traditional frameworks where you spend a lot of time thinking about interfaces between client and server you can often get away with testing both sides of the interface in isolation, but Meteor’s <a href="#test-modes">full app test mode</a> makes it easy to write <a href="#full-app-integration-test">integration tests</a> that cover the full stack. Another challenge here is creating test data in the client context; we’ll discuss ways to do this in the <a href="#generating-test-data">section on generating test data</a> below.</p>
</li>
<li><p><strong>Reactivity</strong>: Meteor’s reactivity system is “eventually consistent” in the sense that when you change a reactive input to the system, you’ll see the user interface change to reflect this some time later. This can be a challenge when testing, but there are some ways to wait until those changes happen to verify the results, for example <code>Tracker.afterFlush()</code>.</p>
</li>
</ul>
<h2 id="test-modes">The ‘meteor test’ command</h2>

<p>The primary way to test your application in Meteor is the <code>meteor test</code> command.</p>
<p>This loads your application in a special “test mode”. What this does is:</p>
<ol>
<li><em>Doesn’t</em> eagerly load <em>any</em> of our application code as Meteor normally would.</li>
<li><em>Does</em> eagerly load any file in our application (including in <code>imports/</code> folders) that look like <code>*.test[s].*</code>, or <code>*.spec[s].*</code></li>
<li>Sets the <code>Meteor.isTest</code> flag to be true.</li>
<li>Starts up the test driver package (<a href="#driver-packages">see below</a>).</li>
</ol>
<blockquote>
<p>The <a href="build-tool.html#what-it-does">Meteor build tool</a> and the <code>meteor test</code> command ignore any files located in any <code>tests/</code> directory. This allows you to put tests in this directory that you can run using a test runner outside of Meteor’s built-in test tools and still not have those files loaded in your application. See Meteor’s <a href="structure.html#load-order">default file load order</a> rules.</p>
</blockquote>
<p>What this means is that you can write tests in files with a certain filename pattern and know they’ll not be included in normal builds of your app. When your app runs in test mode, those files will be loaded (and nothing else will), and they can import the modules you want to test. As we’ll see this is ideal for <a href="#unit-testing">unit tests</a> and <a href="#simple-integration-test">simple integration tests</a>.</p>
<p>Additionally, Meteor offers a “full application” test mode. You can run this with <code>meteor test --full-app</code>.</p>
<p>This is similar to test mode, with key differences:</p>
<ol>
<li>It loads test files matching <code>*.app-test[s].*</code> and <code>*.app-spec[s].*</code>.</li>
<li>It <strong>does</strong> eagerly load our application code as Meteor normally would.</li>
<li>Sets the <code>Meteor.isAppTest</code> flag to be true (instead of the <code>Meteor.isTest</code> flag).</li>
</ol>
<p>This means that the entirety of your application (including for instance the web server and client side router) is loaded and will run as normal. This enables you to write much more <a href="#full-app-integration-test">complex integration tests</a> and also load additional files for <a href="#acceptance-testing">acceptance tests</a>.</p>
<p>Note that there is another test command in the Meteor tool; <code>meteor test-packages</code> is a way of testing Atmosphere packages, which is discussed in the <a href="writing-packages.html#testing">Writing Packages article</a>.</p>
<h3 id="driver-packages">Driver packages</h3>

<p>When you run a <code>meteor test</code> command, you must provide a <code>--driver-package</code> argument. A test driver is a mini-application that runs in place of your app and runs each of your defined tests, whilst reporting the results in some kind of user interface.</p>
<p>There are two main kinds of test driver packages:</p>
<ul>
<li><strong>Web reporters</strong>: Meteor applications that display a special test reporting web UI that you can view the test results in.</li>
</ul>
<p><img src="images/mocha-test-results.png"></p>
<ul>
<li><strong>Console reporters</strong>: These run completely on the command-line and are primary used for automated testing like <a href="#ci">continuous integration</a> (as we’ll see, typically PhantomJS is used to drive such tests).</li>
</ul>
<h3 id="mocha">Recommended: Mocha</h3>

<p>In this article, we’ll use the popular <a href="https://mochajs.org" target="_blank" rel="external">Mocha</a> test runner alongside the <a href="http://chaijs.com" target="_blank" rel="external">Chai</a> assertion library to test our application. In order to write and run tests in Mocha, we need to add an appropriate test driver package.</p>
<p>There are several options. Choose the ones that makes sense for your app. You may depend on more than one and set up different test commands for different situations.</p>
<ul>
<li><a href="https://atmospherejs.com/practicalmeteor/mocha" target="_blank" rel="external">practicalmeteor:mocha</a> Runs client and server package or app tests and displays all results in a browser. Use <a href="https://www.npmjs.com/package/spacejam" target="_blank" rel="external">spacejam</a> for command line / CI support.</li>
<li><a href="https://atmospherejs.com/dispatch/mocha-phantomjs" target="_blank" rel="external">dispatch:mocha-phantomjs</a> Runs client and server package or app tests using PhantomJS and reports all results in the server console. Can be used for running tests on a CI server. Has a watch mode.</li>
<li><a href="https://atmospherejs.com/dispatch/mocha-browser" target="_blank" rel="external">dispatch:mocha-browser</a> Runs client and server package or app tests with Mocha reporting client results in a web browser and server results in the server console. Has a watch mode.</li>
<li><a href="https://atmospherejs.com/dispatch/mocha" target="_blank" rel="external">dispatch:mocha</a> Runs server-only package or app tests with Mocha and reports all results in the server console. Can be used for running tests on a CI server. Has a watch mode.</li>
</ul>
<p>NOTE: Currently tests may not run properly if you add both a <code>practicalmeteor:*</code> package and a <code>dispatch:*</code> package to your app. This is being fixed. See <a href="https://github.com/practicalmeteor/meteor-mocha/issues/23" target="_blank" rel="external">this issue</a>.</p>
<p>These packages don’t do anything in development or production mode. They declare themselves <code>testOnly</code> so they are not even loaded outside of testing. But when our app is run in <a href="#test-modes">test mode</a>, the test driver package takes over, executing test code on both the client and server, and rendering results to the browser.</p>
<p>Here’s how we can add the <a href="https://atmospherejs.com/practicalmeteor/mocha" target="_blank" rel="external"><code>practicalmeteor:mocha</code></a> package to our app:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor add practicalmeteor:mocha</span><br></pre></td></tr></table></figure>
<h2 id="test-files">Test Files</h2>

<p>Test files themselves (for example a file named <code>todos-item.test.js</code> or <code>routing.app-specs.coffee</code>) can register themselves to be run by the test driver in the usual way for that testing library. For Mocha, that’s by using <code>describe</code> and <code>it</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'my module'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'does something that should be tested'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// This code will be executed by the test driver when the app is started</span></span><br><span class="line">    <span class="comment">// in the correct mode</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Note that arrow function use with Mocha <a href="http://mochajs.org/#arrow-functions" target="_blank" rel="external">is discouraged</a>.</p>
<h2 id="test-data">Test data</h2>

<p>When your app is run in test mode, it is initialized with a clean test database.</p>
<p>If you are running a test that relies on using the database, and specifically the content of the database, you’ll need to perform some <em>setup</em> steps in your test to ensure the database is in the state you expect. There are some tools you can use to do this.</p>
<p>To ensure the database is clean, the <a href="https://atmospherejs.com/xolvio/cleaner" target="_blank" rel="external"><code>xolvio:cleaner</code></a> package is useful. You can use it to reset the database in a <code>beforeEach</code> block:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resetDatabase &#125; <span class="keyword">from</span> <span class="string">'meteor/xolvio:cleaner'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'my module'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    resetDatabase();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This technique will only work on the server. If you need to reset the database from a client test, you can use a method to do so:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resetDatabase &#125; <span class="keyword">from</span> <span class="string">'meteor/xolvio:cleaner'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> Before writing a method like this you'll want to double check</span></span><br><span class="line"><span class="comment">// that this file is only going to be loaded in test mode!!</span></span><br><span class="line">Meteor.methods(&#123;</span><br><span class="line">  <span class="string">'test.resetDatabase'</span>: () =&gt; resetDatabase(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'my module'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// We need to wait until the method call is done before moving on, so we</span></span><br><span class="line">    <span class="comment">// use Mocha's async mechanism (calling a done callback)</span></span><br><span class="line">    Meteor.call(<span class="string">'test.resetDatabase'</span>, done);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>As we’ve placed the code above in a test file, it <em>will not</em> load in normal development or production mode (which would be an incredibly bad thing!). If you create a Atmosphere package with a similar feature, you should mark it as <code>testOnly</code> and it will similarly only load in test mode.</p>
<h3 id="generating-test-data">Generating test data</h3>

<p>Often it’s sensible to create a set of data to run your test against. You can use standard <code>insert()</code> calls against your collections to do this, but often it’s easier to create <em>factories</em> which help encode random test data. A great package to use to do this is <a href="https://atmospherejs.com/dburles/factory" target="_blank" rel="external"><code>dburles:factory</code></a>.</p>
<p>In the <a href="https://github.com/meteor/todos" target="_blank" rel="external">Todos</a> example app, we define a factory to describe how to create a test todo item, using the <a href="https://www.npmjs.com/package/faker" target="_blank" rel="external"><code>faker</code></a> npm package:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> faker <span class="keyword">from</span> <span class="string">'faker'</span>;</span><br><span class="line"></span><br><span class="line">Factory.define(<span class="string">'todo'</span>, Todos, &#123;</span><br><span class="line">  listId: () =&gt; Factory.get(<span class="string">'list'</span>),</span><br><span class="line">  text: () =&gt; faker.lorem.sentence(),</span><br><span class="line">  createdAt: () =&gt; <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>To use the factory in a test, we simply call <code>Factory.create</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This creates a todo and a list in the database and returns the todo.</span></span><br><span class="line"><span class="keyword">const</span> todo = Factory.create(<span class="string">'todo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If we have a list already, we can pass in the id and avoid creating another:</span></span><br><span class="line"><span class="keyword">const</span> list = Factory.create(<span class="string">'list'</span>);</span><br><span class="line"><span class="keyword">const</span> todoInList = Factory.create(<span class="string">'todo'</span>, &#123; listId: list._id &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="mocking-the-database">Mocking the database</h3>

<p>As <code>Factory.create</code> directly inserts documents into the collection that’s passed into the <code>Factory.define</code> function, it can be a problem to use it on the client. However there’s a neat isolation trick that you can do to replace the server-backed <code>Todos</code> <a href="collections.html#client-collections">client collection</a> with a mocked out <a href="#collections.html#local-collections">local collection</a>, that’s encoded in the <a href="https://atmospherejs.com/hwillson/stub-collections" target="_blank" rel="external"><code>hwillson:stub-collections</code></a> package.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> StubCollections <span class="keyword">from</span> <span class="string">'meteor/hwillson:stub-collections'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Todos &#125; <span class="keyword">from</span> <span class="string">'path/to/todos.js'</span>;</span><br><span class="line"></span><br><span class="line">StubCollections.stub(Todos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now Todos is stubbed to a simple local collection mock,</span></span><br><span class="line"><span class="comment">//   so for instance on the client we can do:</span></span><br><span class="line">Todos.insert(&#123; a: <span class="string">'document'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Restore the `Todos` collection</span></span><br><span class="line">StubCollections.restore();</span><br></pre></td></tr></table></figure>
<p>In a Mocha test, it makes sense to use <code>stub-collections</code> in a <code>beforeEach</code>/<code>afterEach</code> block.</p>
<h2 id="unit-testing">Unit testing</h2>

<p>Unit testing is the process of isolating a section of code and then testing that the internals of that section work as you expect. As <a href="structure.html">we’ve split our code base up into ES2015 modules</a> it’s natural to test those modules one at a time.</p>
<p>By isolating a module and simply testing its internal functionality, we can write tests that are <em>fast</em> and <em>accurate</em>—they can quickly tell you where a problem in your application lies. Note however that incomplete unit tests can often hide bugs because of the way they stub out dependencies. For that reason it’s useful to combine unit tests with slower (and perhaps less commonly run) integration and acceptance tests.</p>
<h3 id="simple-blaze-unit-test">A simple Blaze unit test</h3>

<p>In the <a href="https://github.com/meteor/todos" target="_blank" rel="external">Todos</a> example app, thanks to the fact that we’ve split our User Interface into <a href="ui-ux.html#components">smart and reusable components</a>, it’s natural to want to unit test some of our reusable components (we’ll see below how to <a href="#simple-integration-test">integration test</a> our smart components).</p>
<p>To do so, we’ll use a very simple test helper that renders a Blaze component off-screen with a given data context. As we place it in <code>imports</code>, it won’t load in our app by in normal mode (as it’s not required anywhere).</p>
<p><a href="https://github.com/meteor/todos/blob/master/imports/ui/test-helpers.js" target="_blank" rel="external"><code>imports/ui/test-helpers.js</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _ &#125; <span class="keyword">from</span> <span class="string">'meteor/underscore'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Template &#125; <span class="keyword">from</span> <span class="string">'meteor/templating'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Blaze &#125; <span class="keyword">from</span> <span class="string">'meteor/blaze'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Tracker &#125; <span class="keyword">from</span> <span class="string">'meteor/tracker'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withDiv = <span class="function"><span class="keyword">function</span> <span class="title">withDiv</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    callback(el);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withRenderedTemplate = <span class="function"><span class="keyword">function</span> <span class="title">withRenderedTemplate</span>(<span class="params">template, data, callback</span>) </span>&#123;</span><br><span class="line">  withDiv((el) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> ourTemplate = _.isString(template) ? Template[template] : template;</span><br><span class="line">    Blaze.renderWithData(ourTemplate, data, el);</span><br><span class="line">    Tracker.flush();</span><br><span class="line">    callback(el);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>A simple example of a reusable component to test is the <a href="https://github.com/meteor/todos/blob/master/imports/ui/components/todos-item.html" target="_blank" rel="external"><code>Todos_item</code></a> template. Here’s what a unit test looks like (you can see some <a href="https://github.com/meteor/todos/blob/master/imports/ui/components/client" target="_blank" rel="external">others in the app repository</a>).</p>
<p><a href="https://github.com/meteor/todos/blob/master/imports/ui/components/client/todos-item.tests.js" target="_blank" rel="external"><code>imports/ui/components/client/todos-item.tests.js</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'meteor/factory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; chai &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:chai'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Template &#125; <span class="keyword">from</span> <span class="string">'meteor/templating'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; $ &#125; <span class="keyword">from</span> <span class="string">'meteor/jquery'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; withRenderedTemplate &#125; <span class="keyword">from</span> <span class="string">'../../test-helpers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../todos-item.js'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Todos_item'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Template.registerHelper(<span class="string">'_'</span>, key =&gt; key);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Template.deregisterHelper(<span class="string">'_'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'renders correctly with simple data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> todo = Factory.build(<span class="string">'todo'</span>, &#123; checked: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      todo,</span><br><span class="line">      onEditingChange: () =&gt; <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    withRenderedTemplate(<span class="string">'Todos_item'</span>, data, el =&gt; &#123;</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">'input[type=text]'</span>).val(), todo.text);</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">'.list-item.checked'</span>).length, <span class="number">0</span>);</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">'.list-item.editing'</span>).length, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Of particular interest in this test is the following:</p>
<h4 id="unit-test-importing">Importing</h4>

<p>When we run our app in test mode, only our test files will be eagerly loaded. In particular, this means that in order to use our templates, we need to import them! In this test, we import <code>todos-item.js</code>, which itself imports <code>todos.html</code> (yes, you do need to import the HTML files of your Blaze templates!)</p>
<h4 id="unit-test-stubbing">Stubbing</h4>

<p>To be a unit test, we must stub out the dependencies of the module. In this case, thanks to the way we’ve isolated our code into a reusable component, there’s not much to do; principally we need to stub out the <code>{{_}}</code> helper that’s created by the <a href="ui-ux.html#i18n"><code>tap:i18n</code></a> system. Note that we stub it out in a <code>beforeEach</code> and restore it the <code>afterEach</code>.</p>
<p>If you’re testing code that makes use of globals, you’ll need to import those globals. For instance if you have a global <code>Todos</code> collection and are testing this file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logging.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logTodos</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(Todos.findOne());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>then you’ll need to import <code>Todos</code> both in that file and in the test:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logging.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Todos &#125; <span class="keyword">from</span> <span class="string">'./todos.js'</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logTodos</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(Todos.findOne());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logging.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Todos &#125; <span class="keyword">from</span> <span class="string">'./todos.js'</span></span><br><span class="line">Todos.findOne = () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;text: <span class="string">"write a guide"</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; logTodos &#125; <span class="keyword">from</span> <span class="string">'./logging.js'</span></span><br><span class="line"><span class="comment">// then test logTodos</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="unit-test-data">Creating data</h4>

<p>We can use the <a href="#test-data">Factory package’s</a> <code>.build()</code> API to create a test document without inserting it into any collection. As we’ve been careful not to call out to any collections directly in the reusable component, we can pass the built <code>todo</code> document directly into the template.</p>
<h3 id="simple-react-unit-test">A simple React unit test</h3>

<p>We can also apply the same structure to testing React components and recommend the <a href="https://github.com/airbnb/enzyme" target="_blank" rel="external">Enzyme</a> package, which simulates a React component’s environment and allows you to query it using CSS selectors. A larger suite of tests is available in the <a href="https://github.com/meteor/todos/tree/react" target="_blank" rel="external">react branch of the Todos app</a>, but let’s look at a simple example for now:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'meteor/factory'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; chai &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:chai'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">'./TodoItem.jsx'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'should render'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> todo = Factory.build(<span class="string">'todo'</span>, &#123; text: <span class="string">'testing'</span>, checked: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> item = shallow(<span class="xml"><span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span> /&gt;</span>);</span><br><span class="line">    chai.assert(item.hasClass('list-item'));</span><br><span class="line">    chai.assert(!item.hasClass('checked'));</span><br><span class="line">    chai.assert.equal(item.find('.editing').length, 0);</span><br><span class="line">    chai.assert.equal(item.find('input[type="text"]').prop('defaultValue'), 'testing');</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>The test is slightly simpler than the Blaze version above because the React sample app is not internationalized. Otherwise, it’s conceptually identical. We use Enzyme’s <code>shallow</code> function to render the <code>TodoItem</code> component, and the resulting object to query the document, and also to simulate user interactions. And here’s an example of simulating a user checking the todo item:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'meteor/factory'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sinon &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:sinon'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">'./TodoItem.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setCheckedStatus &#125; <span class="keyword">from</span> <span class="string">'../../api/todos/methods.js'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'TodoItem'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'should update status when checked'</span>, () =&gt; &#123;</span><br><span class="line">    sinon.stub(setCheckedStatus, <span class="string">'call'</span>);</span><br><span class="line">    <span class="keyword">const</span> todo = Factory.create(<span class="string">'todo'</span>, &#123; checked: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> item = shallow(<span class="xml"><span class="tag">&lt;<span class="name">TodoItem</span> <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span> /&gt;</span>);</span><br><span class="line"></span><br><span class="line">    item.find('input[type="checkbox"]').simulate('change', &#123;</span><br><span class="line">      target: &#123; checked: true &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    sinon.assert.calledWith(setCheckedStatus.call, &#123;</span><br><span class="line">      todoId: todo._id,</span><br><span class="line">      newCheckedStatus: true,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    setCheckedStatus.call.restore();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>In this case, the <code>TodoItem</code> component calls a <a href="/methods.html">Meteor Method</a> <code>setCheckedStatus</code> when the user clicks, but this is a unit test so there’s no server running. So we stub it out using <a href="http://sinonjs.org" target="_blank" rel="external">Sinon</a>. After we simulate the click, we verify that the stub was called with the correct arguments. Finally, we clean up the stub and restore the original method behavior.</p>
<h3 id="running-unit-tests">Running unit tests</h3>

<p>To run the tests that our app defines, we run our app in <a href="#test-modes">test mode</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --driver-package practicalmeteor:mocha</span><br></pre></td></tr></table></figure>
<p>As we’ve defined a test file (<code>imports/todos/todos.tests.js</code>), what this means is that the file above will be eagerly loaded, adding the <code>&#39;builds correctly from factory&#39;</code> test to the Mocha registry.</p>
<p>To run the tests, visit <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a> in your browser. This kicks off <code>practicalmeteor:mocha</code>, which runs your tests both in the browser and on the server. It displays the test results in the browser in a Mocha test reporter:</p>
<p><img src="images/mocha-test-results.png"></p>
<p>Usually, while developing an application, it make sense to run <code>meteor test</code> on a second port (say <code>3100</code>), while also running your main application in a separate process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one terminal window</span></span><br><span class="line">meteor</span><br><span class="line"></span><br><span class="line"><span class="comment"># in another</span></span><br><span class="line">meteor <span class="built_in">test</span> --driver-package practicalmeteor:mocha --port 3100</span><br></pre></td></tr></table></figure>
<p>Then you can open two browser windows to see the app in action while also ensuring that you don’t break any tests as you make changes.</p>
<h3 id="isolation-techniques">Isolation techniques</h3>

<p>In the <a href="#simple-blaze-unit-test">unit tests above</a> we saw a very limited example of how to isolate a module from the larger app. This is critical for proper unit testing. Some other utilities and techniques include:</p>
<ul>
<li><p>The <a href="https://atmospherejs.com/velocity/meteor-stubs" target="_blank" rel="external"><code>velocity:meteor-stubs</code></a> package, which creates simple stubs for most Meteor core objects.</p>
</li>
<li><p>Alternatively, you can also use tools like <a href="http://sinonjs.org" target="_blank" rel="external">Sinon</a> to stub things directly, as we’ll see for example in our <a href="#simple-integration-test">simple integration test</a>.</p>
</li>
<li><p>The <a href="https://atmospherejs.com/hwillson/stub-collections" target="_blank" rel="external"><code>hwillson:stub-collections</code></a> package we mentioned <a href="#mocking-the-database">above</a>.</p>
</li>
</ul>
<p>There’s a lot of scope for better isolation and testing utilities.</p>
<h4 id="testing-publications">Testing publications</h4>

<p>Using the <a href="https://atmospherejs.com/johanbrook/publication-collector" target="_blank" rel="external"><code>johanbrook:publication-collector</code></a> package, you’re able to test individual publication’s output without needing to create a traditional subscription:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'lists.public'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'sends all public lists'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Set a user id that will be provided to the publish function as `this.userId`,</span></span><br><span class="line">    <span class="comment">// in case you want to test authentication.</span></span><br><span class="line">    <span class="keyword">const</span> collector = <span class="keyword">new</span> PublicationCollector(&#123;userId: <span class="string">'some-id'</span>&#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Collect the data published from the `lists.public` publication.</span></span><br><span class="line">    collector.collect(<span class="string">'lists.public'</span>, (collections) =&gt; &#123;</span><br><span class="line">      <span class="comment">// `collections` is a dictionary with collection names as keys,</span></span><br><span class="line">      <span class="comment">// and their published documents as values in an array.</span></span><br><span class="line">      <span class="comment">// Here, documents from the collection 'Lists' are published.</span></span><br><span class="line">      chai.assert.typeOf(collections.Lists, <span class="string">'array'</span>);</span><br><span class="line">      chai.assert.equal(collections.Lists.length, <span class="number">3</span>);</span><br><span class="line">      done();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Note that user documents – ones that you would normally query with <code>Meteor.users.find()</code> – will be available as the key <code>users</code> on the dictionary passed from a <code>PublicationCollector.collect()</code> call. See the <a href="https://github.com/johanbrook/meteor-publication-collector/blob/master/tests/publication-collector.test.js" target="_blank" rel="external">tests</a> in the package for more details.</p>
<h2 id="integration-testing">Integration testing</h2>

<p>An integration test is a test that crosses module boundaries. In the simplest case, this simply means something very similar to a unit test, where you perform your isolation around multiple modules, creating a non-singular “system under test”.</p>
<p>Although conceptually different to unit tests, such tests typically do not need to be run any differently to unit tests and can use the same <a href="#running-unit-tests"><code>meteor test</code> mode</a> and <a href="#isolation-techniques">isolation techniques</a> as we use for unit tests.</p>
<p>However, an integration test that crosses the client-server boundary of a Meteor application (where the modules under test cross that boundary) requires a different testing infrastructure, namely Meteor’s “full app” testing mode.</p>
<p>Let’s take a look at example of both kinds of tests.</p>
<h3 id="simple-integration-test">Simple integration test</h3>

<p>Our reusable components were a natural fit for a unit test; similarly our smart components tend to require an integration test to really be exercised properly, as the job of a smart component is to bring data together and supply it to a reusable component.</p>
<p>In the <a href="https://github.com/meteor/todos" target="_blank" rel="external">Todos</a> example app, we have an integration test for the <code>Lists_show_page</code> smart component. This test simply ensures that when the correct data is present in the database, the template renders correctly – that it is gathering the correct data as we expect. It isolates the rendering tree from the more complex data subscription part of the Meteor stack. If we wanted to test that the subscription side of things was working in concert with the smart component, we’d need to write a <a href="#full-app-integration-test">full app integration test</a>.</p>
<p><a href="https://github.com/meteor/todos/blob/master/imports/ui/components/client/todos-item.tests.js" target="_blank" rel="external"><code>imports/ui/components/client/todos-item.tests.js</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Meteor &#125; <span class="keyword">from</span> <span class="string">'meteor/meteor'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'meteor/factory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Random &#125; <span class="keyword">from</span> <span class="string">'meteor/random'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; chai &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:chai'</span>;</span><br><span class="line"><span class="keyword">import</span> StubCollections <span class="keyword">from</span> <span class="string">'meteor/hwillson:stub-collections'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Template &#125; <span class="keyword">from</span> <span class="string">'meteor/templating'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; _ &#125; <span class="keyword">from</span> <span class="string">'meteor/underscore'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; $ &#125; <span class="keyword">from</span> <span class="string">'meteor/jquery'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FlowRouter &#125; <span class="keyword">from</span> <span class="string">'meteor/kadira:flow-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sinon &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:sinon'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; withRenderedTemplate &#125; <span class="keyword">from</span> <span class="string">'../../test-helpers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../lists-show-page.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Todos &#125; <span class="keyword">from</span> <span class="string">'../../../api/todos/todos.js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Lists &#125; <span class="keyword">from</span> <span class="string">'../../../api/lists/lists.js'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Lists_show_page'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> listId = Random.id();</span><br><span class="line"></span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    StubCollections.stub([Todos, Lists]);</span><br><span class="line">    Template.registerHelper(<span class="string">'_'</span>, key =&gt; key);</span><br><span class="line">    sinon.stub(FlowRouter, <span class="string">'getParam'</span>, () =&gt; listId);</span><br><span class="line">    sinon.stub(Meteor, <span class="string">'subscribe'</span>, () =&gt; (&#123;</span><br><span class="line">      subscriptionId: <span class="number">0</span>,</span><br><span class="line">      ready: () =&gt; <span class="literal">true</span>,</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    StubCollections.restore();</span><br><span class="line">    Template.deregisterHelper(<span class="string">'_'</span>);</span><br><span class="line">    FlowRouter.getParam.restore();</span><br><span class="line">    Meteor.subscribe.restore();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'renders correctly with simple data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Factory.create(<span class="string">'list'</span>, &#123; _id: listId &#125;);</span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> todos = _.times(<span class="number">3</span>, i =&gt; Factory.create(<span class="string">'todo'</span>, &#123;</span><br><span class="line">      listId,</span><br><span class="line">      createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp - (<span class="number">3</span> - i)),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    withRenderedTemplate(<span class="string">'Lists_show_page'</span>, &#123;&#125;, el =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> todosText = todos.map(t =&gt; t.text).reverse();</span><br><span class="line">      <span class="keyword">const</span> renderedText = $(el).find(<span class="string">'.list-items input[type=text]'</span>)</span><br><span class="line">        .map((i, e) =&gt; $(e).val())</span><br><span class="line">        .toArray();</span><br><span class="line">      chai.assert.deepEqual(renderedText, todosText);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Of particular interest in this test is the following:</p>
<h4 id="simple-integration-test-importing">Importing</h4>

<p>As we’ll run this test in the same way that we did our unit test, we need to <code>import</code> the relevant modules under test in the same way that we <a href="#simple-integration-test-importing">did in the unit test</a>.</p>
<h4 id="simple-integration-test-stubbing">Stubbing</h4>

<p>As the system under test in our integration test has a larger surface area, we need to stub out a few more points of integration with the rest of the stack. Of particular interest here is our use of the <a href="#mocking-the-database"><code>hwillson:stub-collections</code></a> package and of <a href="https://sinonjs.org" target="_blank" rel="external">Sinon</a> to stub out Flow Router and our Subscription.</p>
<h4 id="simple-integration-test-data">Creating data</h4>

<p>In this test, we used <a href="#test-data">Factory package’s</a> <code>.create()</code> API, which inserts data into the real collection. However, as we’ve proxied all of the <code>Todos</code> and <code>Lists</code> collection methods onto a local collection (this is what <code>hwillson:stub-collections</code> is doing), we won’t run into any problems with trying to perform inserts from the client.</p>
<p>This integration test can be run the exact same way as we ran <a href="#running-unit-tests">unit tests above</a>.</p>
<h3 id="full-app-integration-test">Full-app integration test</h3>

<p>In the <a href="https://github.com/meteor/todos" target="_blank" rel="external">Todos</a> example application, we have a integration test which ensures that we see the full contents of a list when we route to it, which demonstrates a few techniques of integration tests.</p>
<p><a href="https://github.com/meteor/todos/blob/master/imports/startup/client/routes.app-test.js" target="_blank" rel="external"><code>imports/startup/client/routes.app-test.js</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Meteor &#125; <span class="keyword">from</span> <span class="string">'meteor/meteor'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Tracker &#125; <span class="keyword">from</span> <span class="string">'meteor/tracker'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; DDP &#125; <span class="keyword">from</span> <span class="string">'meteor/ddp-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FlowRouter &#125; <span class="keyword">from</span> <span class="string">'meteor/kadira:flow-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; assert &#125; <span class="keyword">from</span> <span class="string">'meteor/practicalmeteor:chai'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Promise</span> &#125; <span class="keyword">from</span> <span class="string">'meteor/promise'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; $ &#125; <span class="keyword">from</span> <span class="string">'meteor/jquery'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; generateData &#125; <span class="keyword">from</span> <span class="string">'./../../api/generate-data.app-tests.js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Lists &#125; <span class="keyword">from</span> <span class="string">'../../api/lists/lists.js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Todos &#125; <span class="keyword">from</span> <span class="string">'../../api/todos/todos.js'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Utility -- returns a promise which resolves when all subscriptions are done</span></span><br><span class="line"><span class="keyword">const</span> waitForSubscriptions = () =&gt; <span class="keyword">new</span> <span class="built_in">Promise</span>(resolve =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> poll = Meteor.setInterval(() =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (DDP._allSubscriptionsReady()) &#123;</span><br><span class="line">      clearInterval(poll);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">200</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tracker.afterFlush runs code when all consequent of a tracker based change</span></span><br><span class="line"><span class="comment">//   (such as a route change) have occured. This makes it a promise.</span></span><br><span class="line"><span class="keyword">const</span> afterFlushPromise = <span class="built_in">Promise</span>.denodeify(Tracker.afterFlush);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Meteor.isClient) &#123;</span><br><span class="line">  describe(<span class="string">'data available when routed'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// First, ensure the data that we expect is loaded on the server</span></span><br><span class="line">    <span class="comment">//   Then, route the app to the homepage</span></span><br><span class="line">    beforeEach(() =&gt; generateData().then(() =&gt; FlowRouter.go(<span class="string">'/'</span>)));</span><br><span class="line"></span><br><span class="line">    describe(<span class="string">'when logged out'</span>, () =&gt; &#123;</span><br><span class="line">      it(<span class="string">'has all public lists at homepage'</span>, () =&gt; &#123;</span><br><span class="line">        assert.equal(Lists.find().count(), <span class="number">3</span>);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      it(<span class="string">'renders the correct list when routed to'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> list = Lists.findOne();</span><br><span class="line">        FlowRouter.go(<span class="string">'Lists.show'</span>, &#123; _id: list._id &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> afterFlushPromise()</span><br><span class="line">          .then(() =&gt; &#123;</span><br><span class="line">            assert.equal($(<span class="string">'.title-wrapper'</span>).html(), list.name);</span><br><span class="line">          &#125;)</span><br><span class="line">          .then(() =&gt; waitForSubscriptions())</span><br><span class="line">          .then(() =&gt; &#123;</span><br><span class="line">            assert.equal(Todos.find(&#123; listId: list._id &#125;).count(), <span class="number">3</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Of note here:</p>
<ul>
<li><p>Before running, each test sets up the data it needs using the <code>generateData</code> helper (see <a href="#creating-integration-test-data">the section on creating integration test data</a> for more detail) then goes to the homepage.</p>
</li>
<li><p>Although Flow Router doesn’t take a done callback, we can use <code>Tracker.afterFlush</code> to wait for all its reactive consequences to occur.</p>
</li>
<li><p>Here we wrote a little utility (which could be abstracted into a general package) to wait for all the subscriptions which are created by the route change (the <code>todos.inList</code> subscription in this case) to become ready before checking their data.</p>
</li>
</ul>
<h3 id="running-full-app-tests">Running full-app tests</h3>

<p>To run the <a href="#test-modes">full-app tests</a> in our application, we run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --full-app --driver-package practicalmeteor:mocha</span><br></pre></td></tr></table></figure>
<p>When we connect to the test instance in a browser, we want to render a testing UI rather than our app UI, so the <code>mocha-web-reporter</code> package will hide any UI of our application and overlay it with its own. However the app continues to behave as normal, so we are able to route around and check the correct data is loaded.</p>
<h3 id="creating-integration-test-data">Creating data</h3>

<p>To create test data in full-app test mode, it usually makes sense to create some special test methods which we can call from the client side. Usually when testing a full app, we want to make sure the publications are sending through the correct data (as we do in this test), and so it’s not sufficient to stub out the collections and place synthetic data in them. Instead we’ll want to actually create data on the server and let it be published.</p>
<p>Similar to the way we cleared the database using a method in the <code>beforeEach</code> in the <a href="#test-data">test data</a> section above, we can call a method to do that before running our tests. In the case of our routing tests, we’ve used a file called <a href="https://github.com/meteor/todos/blob/master/imports/api/generate-data.app-tests.js" target="_blank" rel="external"><code>imports/api/generate-data.app-tests.js</code></a> which defines this method (and will only be loaded in full app test mode, so is not available in general!):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file will be auto-imported in the app-test context,</span></span><br><span class="line"><span class="comment">// ensuring the method is always available</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Meteor &#125; <span class="keyword">from</span> <span class="string">'meteor/meteor'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'meteor/factory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; resetDatabase &#125; <span class="keyword">from</span> <span class="string">'meteor/xolvio:cleaner'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Random &#125; <span class="keyword">from</span> <span class="string">'meteor/random'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; _ &#125; <span class="keyword">from</span> <span class="string">'meteor/underscore'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createList = (userId) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = Factory.create(<span class="string">'list'</span>, &#123; userId &#125;);</span><br><span class="line">  _.times(<span class="number">3</span>, () =&gt; Factory.create(<span class="string">'todo'</span>, &#123; listId: list._id &#125;));</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remember to double check this is a test-only file before</span></span><br><span class="line"><span class="comment">// adding a method like this!</span></span><br><span class="line">Meteor.methods(&#123;</span><br><span class="line">  generateFixtures: <span class="function"><span class="keyword">function</span> <span class="title">generateFixturesMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    resetDatabase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create 3 public lists</span></span><br><span class="line">    _.times(<span class="number">3</span>, () =&gt; createList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create 3 private lists</span></span><br><span class="line">    _.times(<span class="number">3</span>, () =&gt; createList(Random.id()));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generateData;</span><br><span class="line"><span class="keyword">if</span> (Meteor.isClient) &#123;</span><br><span class="line">  <span class="comment">// Create a second connection to the server to use to call</span></span><br><span class="line">  <span class="comment">// test data methods. We do this so there's no contention</span></span><br><span class="line">  <span class="comment">// with the currently tested user's connection.</span></span><br><span class="line">  <span class="keyword">const</span> testConnection = Meteor.connect(Meteor.absoluteUrl());</span><br><span class="line"></span><br><span class="line">  generateData = <span class="built_in">Promise</span>.denodeify((cb) =&gt; &#123;</span><br><span class="line">    testConnection.call(<span class="string">'generateFixtures'</span>, cb);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; generateData &#125;;</span><br></pre></td></tr></table></figure>
<p>Note that we’ve exported a client-side symbol <code>generateData</code> which is a promisified version of the method call, which makes it simpler to use this sequentially in tests.</p>
<p>Also of note is the way we use a second DDP connection to the server in order to send these test “control” method calls.</p>
<h2 id="acceptance-testing">Acceptance testing</h2>

<p>Acceptance testing is the process of taking an unmodified version of our application and testing it from the “outside” to make sure it behaves in a way we expect. Typically if an app passes acceptance tests, we have done our job properly from a product perspective.</p>
<p>As acceptance tests test the behavior of the application in a full browser context in a generic way, there are a range of tools that you can use to specify and run such tests. In this guide we’ll demonstrate using <a href="https://chimp.readme.io" target="_blank" rel="external">Chimp</a>, an acceptance testing tool with a few neat Meteor-specific features that makes it easy to use.</p>
<p>Chimp requires node version 4 or 5. You can check your node version by running:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<p>You can install version 4 from <a href="https://nodejs.org/en/download/" target="_blank" rel="external">nodejs.org</a> or version 5 with <code>brew install node</code>. Then we can install the Chimp tool globally using:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global chimp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note that you can also install Chimp as a <code>devDependency</code> in your <code>package.json</code> but you may run into problems deploying your application as it includes binary dependencies. You can avoid such problems by running <code>meteor npm prune</code> to remove non-production dependencies before deploying.</p>
</blockquote>
<p>Chimp has a variety of options for setting it up, but we can add some npm scripts which will run the currently tests we define in Chimp’s two main modes. We can add them to our <code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"chimp-watch"</span>: <span class="string">"chimp --ddp=http://localhost:3000 --watch --mocha --path=tests"</span>,</span><br><span class="line">    <span class="attr">"chimp-test"</span>: <span class="string">"chimp --mocha --path=tests"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Chimp will now look in the <code>tests/</code> directory (otherwise ignored by the Meteor tool) for files in which you define acceptance tests. In the <a href="https://github.com/meteor/todos" target="_blank" rel="external">Todos</a> example app, we define a simple test that ensures we can click the “create list” button.</p>
<p><a href="https://github.com/meteor/todos/blob/master/tests/lists.js" target="_blank" rel="external"><code>tests/lists.js</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These are Chimp globals</span></span><br><span class="line"><span class="comment">/* globals browser assert server */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countLists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  browser.waitForExist(<span class="string">'.list-todo'</span>);</span><br><span class="line">  <span class="keyword">const</span> elements = browser.elements(<span class="string">'.list-todo'</span>);</span><br><span class="line">  <span class="keyword">return</span> elements.value.length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'list ui'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    browser.url(<span class="string">'http://localhost:3000'</span>);</span><br><span class="line">    server.call(<span class="string">'generateFixtures'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'can create a list @watch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> initialCount = countLists();</span><br><span class="line"></span><br><span class="line">    browser.click(<span class="string">'.js-new-list'</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(countLists(), initialCount + <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="running-acceptance-tests">Running acceptance tests</h3>

<p>To run acceptance tests, we simply need to start our Meteor app as usual, and point Chimp at it.</p>
<p>In one terminal, we can do:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor</span><br></pre></td></tr></table></figure>
<p>In another:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor npm run chimp-watch</span><br></pre></td></tr></table></figure>
<p>The <code>chimp-watch</code> command will then run the test in a browser, and continue to re-run it as we change the test or the application. (Note that the test assumes we are running the app on port <code>3000</code>).</p>
<p>Thus it’s a good way to develop the test—this is why chimp has a feature where we mark tests with a <code>@watch</code> in the name to call out the tests we want to work on (running our entire acceptance test suite can be time consuming in a large application).</p>
<p>The <code>chimp-test</code> command will run all of the tests <em>once only</em> and is good for testing that our suite passes, either as a manual step, or as part of a <a href="#ci">continuous integration</a> process.</p>
<h3 id="creating-acceptance-test-data">Creating data</h3>

<p>Although we can run the acceptance test against our “pure” Meteor app, as we’ve done above, it often makes sense to start our meteor server with a special test driver, <code>tmeasday:acceptance-test-driver</code>. (You’ll need to <code>meteor add</code> it to your app):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --full-app --driver-package tmeasday:acceptance-test-driver</span><br></pre></td></tr></table></figure>
<p>The advantage of running our acceptance test suite pointed at an app that runs in full app test mode is that all of the <a href="#creating-integration-test-data">data generating methods</a> that we’ve created remain available. Otherwise the <code>acceptance-test-driver</code> does nothing.</p>
<p>In Chimp tests, you have a DDP connection to the server available on the <code>server</code> variable. You can thus use <code>server.call()</code> (which is wrapped to be synchronous in Chimp tests) to call these methods. This is a convenient way to share data preparation code between acceptance and integration tests.</p>
<h2 id="ci">Continuous Integration</h2>

<p>Continuous integration testing is the process of running tests on every commit of your project.</p>
<p>There are two principal ways to do it: on the developer’s machine before allowing them to push code to the central repository, and on a dedicated CI server after each push. Both techniques are useful, and both require running tests in a commandline-only fashion.</p>
<h3 id="command-line">Command line</h3>

<p>We’ve seen one example of running tests on the command line, using our <code>meteor npm run chimp-test</code> mode.</p>
<p>We can also use a command-line driver for Mocha <a href="http://atmospherejs.com/dispatch/mocha-phantomjs" target="_blank" rel="external"><code>dispatch:mocha-phantomjs</code></a> to run our standard tests on the command line.</p>
<p>Adding and using the package is straightforward:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meteor add dispatch:mocha-phantomjs</span><br><span class="line">meteor <span class="built_in">test</span> --once --driver-package dispatch:mocha-phantomjs</span><br></pre></td></tr></table></figure>
<p>(The <code>--once</code> argument ensures the Meteor process stops once the test is done).</p>
<p>We can also add that command to our <code>package.json</code> as a <code>test</code> script:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"meteor test --once --driver-package dispatch:mocha-phantomjs"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we can run the tests with <code>meteor npm test</code>.</p>
<h3 id="using-circle-ci">CircleCI</h3>

<p><a href="https://circleci.com" target="_blank" rel="external">CircleCI</a> is a great continuous integration service that allows us to run (possibly time consuming) tests on every push to a repository like GitHub. To use it with the commandline test we’ve defined above, we can follow their standard <a href="https://circleci.com/docs/getting-started" target="_blank" rel="external">getting started tutorial</a> and use a <code>circle.yml</code> file similar to this:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">machine</span>:</span><br><span class="line">  <span class="attribute">node</span>:</span><br><span class="line">    <span class="attribute">version</span>: <span class="number">0.10</span>.<span class="number">43</span></span><br><span class="line"><span class="attribute">dependencies</span>:</span><br><span class="line">  <span class="attribute">override</span>:</span><br><span class="line">    - curl <span class="attribute">https</span>:<span class="comment">//install.meteor.com | /bin/sh</span></span><br><span class="line">    - npm install</span><br><span class="line"><span class="attribute">checkout</span>:</span><br><span class="line">  <span class="attribute">post</span>:</span><br><span class="line">    - git submodule update --init</span><br></pre></td></tr></table></figure>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="structure.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Application Structure
        </a>
      
      
        <a class="link primary next"
          href="ui-ux.html">
          <span class="subtitle-pagination">Next</span>
          User Interfaces
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/ourmeteor/guide-zh/tree/master/content/testing.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
    <div class="discourse-comments-wrapper content-wrapper">
      <div id='discourse-comments'></div>
    </div>

    <script type="text/javascript">
      DiscourseEmbed = { discourseUrl: 'http://forums.meteor.com/',
                         topicId: 20191 };

      (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
        d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
      })();
    </script>
  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     
      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("zQx6cQifkTU79E3L0XAnmrOXP2A5bC6r");
        analytics.page()
        }}();
      

      // search box
      

        ['desktop', 'mobile'].forEach(function(type) {
          var search = docsearch({
            apiKey: 'b123b42bb515f300dc09dc88f7695ec1',
            indexName: 'meteor_guide',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      

      
        var REDIRECTS = {
  "/using-packages.html": "atmosphere-vs-npm.html",
  "/using-packages.html#npm": "using-npm-packages.html",
  "/using-packages.html#client-npm": "using-npm-packages.html#client-npm",
  "/using-packages.html#installing-npm": "using-npm-packages.html#installing-npm",
  "/using-packages.html#using-npm": "using-npm-packages.html#using-npm",
  "/using-packages.html#npm-styles": "using-npm-packages.html#npm-styles",
  "/using-packages.html#npm-shrinkwrap": "using-npm-packages.html#npm-shrinkwrap",
  "/using-packages.html#atmosphere": "using-atmosphere-packages.html",
  "/using-packages.html#atmosphere-searching": "using-atmosphere-packages.html#atmosphere-searching",
  "/using-packages.html#atmosphere-naming": "using-atmosphere-packages.html#atmosphere-naming",
  "/using-packages.html#installing-atmosphere": "using-atmosphere-packages.html#installing-atmosphere",
  "/using-packages.html#using-atmosphere": "using-atmosphere-packages.html#using-atmosphere",
  "/using-packages.html#importing-atmosphere-styles": "using-atmosphere-packages.html#importing-atmosphere-styles",
  "/using-packages.html#peer-npm-dependencies": "using-atmosphere-packages.html#peer-npm-dependencies",
  "/using-packages.html#package-namespacing": "using-atmosphere-packages.html#package-namespacing",
  "/using-packages.html#async-callbacks": "using-npm-packages.html#async-callbacks",
  "/using-packages.html#bind-environment": "using-npm-packages.html#bind-environment",
  "/using-packages.html#wrap-async": "using-npm-packages.html#wrap-async",
  "/using-packages.html#promises": "using-npm-packages.html#promises",
  "/using-packages.html#overriding-packages": "writing-npm-packages.html#overriding-npm-packages",
  "/using-packages.html#npm-overriding": "writing-npm-packages.html#overriding-npm-packages",
  "/using-packages.html#atmosphere-overriding": "writing-atmosphere-packages.html#overriding-atmosphere-packages",
  "/using-packages.html#npm-shrinkpack": "using-npm-packages.html#npm-shrinkpack",
  "/writing-packages.html": "writing-atmosphere-packages.html",
  "/writing-packages.html#npm-vs-atmosphere": "atmosphere-vs-npm.html",
  "/writing-packages.html#creating-npm": "writing-npm-packages.html",
  "/writing-packages.html#including-in-app": "writing-npm-packages.html#including-in-app",
  "/writing-packages.html#publishing-npm": "writing--packages.html#publishing-npm",
  "/writing-packages.html#creating": "writing-atmosphere-packages.html",
  "/writing-packages.html#adding-files": "writing-atmosphere-packages.html#adding-files",
  "/writing-packages.html#adding-javascript": "writing-atmosphere-packages.html#adding-javascript",
  "/writing-packages.html#adding-css": "writing-atmosphere-packages.html#adding-css",
  "/writing-packages.html#adding-style": "writing-atmosphere-packages.html#adding-style",
  "/writing-packages.html#adding-assests": "writing-atmosphere-packages.html#adding-assets",
  "/writing-packages.html#exporting": "writing-atmosphere-packages.html#exporting",
  "/writing-packages.html#dependencies": "writing-atmosphere-packages.html#dependencies",
  "/writing-packages.html#atmosphere-dependencies": "writing-atmosphere--packages.html#atmosphere-dependencies",
  "/writing-packages.html#meteor-version-dependencies": "writing-atmosphere-packages.html#meteor-version-dependencies",
  "/writing-packages.html#version-constraints": "writing-atmosphere-packages.html#version-constraints",
  "/writing-packages.html#npm-dependencies": "writing-atmosphere-packages.html#npm-dependencies",
  "/writing-packages.html#peer-npm-dependencies": "writing-atmosphere-packages.html#peer-npm-dependencies",
  "/writing-packages.html#cordova-plugins": "writing-atmosphere-packages.html#cordova-plugins",
  "/writing-packages.html#testing": "writing-atmosphere-packages.html#testing",
  "/writing-packages.html#testing-with-peer-dependencies": "writing-atmosphere-packages.html#testing-with-peer-dependencies",
  "/writing-packages.html#local-vs-published": "writing-atmosphere-packages.html#local-vs-published",
  "/writing-packages.html#build-plugins": "build-tool.html#build-plugins",
  "/writing-packages.html#types-of-build-plugins": "build-tool.html#types-of-build-plugins",
  "/writing-packages.html#writing-build-plugins": "build-tool.html#writing-build-plugins",
  "/writing-packages.html#caching-build-plugins": "build-tool.html#caching-build-plugins",
  "/testing.html#simple-unit-test": "testing.html#simple-blaze-unit-test"
};

        function redirect() {
          // Support redirects of the form /path#hash
          var locationKey = location.pathname + location.hash;
          if (REDIRECTS[locationKey]) {
            location.replace(location.origin + '/' + REDIRECTS[locationKey]);
          }

          // Support redirects of the form #hash (works for any path)
          var hashKey = location.hash;
          if (REDIRECTS[hashKey]) {
            location.replace(location.origin + '/' + REDIRECTS[hashKey]);
          }
        }

        // Redirect now
        redirect();

        // Redirect on hash change
        window.onhashchange = redirect;
      
    </script>
  </body>
</html>
